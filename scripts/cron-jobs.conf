# MarinaObuv Cron Jobs (managed by install-crons.sh)
# Each line should end with a unique marker comment for idempotent updates

# Daily DB backup at 03:00 (keeps 3 backups via script retention)
# Disable with: DISABLE_CRON_BACKUP=true
0 3 * * * cd /var/www/marinaobuv/web && export $(grep -v '^#' ./.env | xargs) && [ "$DISABLE_CRON_BACKUP" != "true" ] && /usr/bin/env ./node_modules/.bin/tsx scripts/backup-database.ts >> /var/www/marinaobuv/web/logs/backup.log 2>&1 # JOB:db-backup

# Groq parser cron (every 4 hours)
# Disable with: DISABLE_CRON_PARSING=true
0 */4 * * * cd /var/www/marinaobuv/web && NODE_ENV=production [ "$DISABLE_CRON_PARSING" != "true" ] && /usr/bin/env ./node_modules/.bin/tsx src/scripts/groq-sequential-cron.ts >> /var/www/marinaobuv/web/logs/parsing-cron.log 2>&1 # JOB:parser-hourly

# Poll Green API incoming queue every 5 minutes (drains queued webhooks)
# Disable with: DISABLE_CRON_QUEUE=true
*/5 * * * * cd /var/www/marinaobuv/web && NODE_ENV=production [ "$DISABLE_CRON_QUEUE" != "true" ] && POLL_MAX=200 /usr/bin/env ./node_modules/.bin/tsx src/scripts/poll-green-api-queue.ts >> /var/www/marinaobuv/web/logs/green-queue.log 2>&1 # JOB:green-queue

# Batch polling every 5 minutes (processes completed OpenAI batches)
# Disable with: DISABLE_CRON_BATCH_POLL=true
*/5 * * * * cd /var/www/marinaobuv/web && NODE_ENV=production [ "$DISABLE_CRON_BATCH_POLL" != "true" ] && /usr/bin/env ./node_modules/.bin/tsx src/scripts/batch-poll-v2.ts >> /var/www/marinaobuv/web/logs/batch-poll.log 2>&1 # JOB:batch-poll

# Groq proxy auto-restart monitoring every 2 minutes
# Disable with: DISABLE_CRON_PROXY_MONITOR=true
*/2 * * * * cd /var/www/marinaobuv && [ "$DISABLE_CRON_PROXY_MONITOR" != "true" ] && /usr/bin/env ./scripts/auto-restart-proxy.sh >> /var/www/marinaobuv/logs/proxy-cron.log 2>&1 # JOB:proxy-monitor

